<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Administraci√≥n - TemuGram</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='estilos.css') }}">
</head>
<body>
    <div class="panel">
        <a href="/" class="btn-back">‚Üê Volver al Inicio</a>
        
        <h2>‚öôÔ∏è Gesti√≥n de Usuarios</h2>
        <table>
            <thead>
                <tr>
                    <th>Usuario</th>
                    <th>Rol Actual</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for u in usuarios %}
                <tr>
                    <td><strong>@{{ u[1] }}</strong></td>
                    <td>{{ u[2] }}</td>
                    <td>
                        <div style="display:flex; gap:10px; align-items: center;">
                            <form action="/admin/cambiar_rol" method="POST" style="display:flex; gap:5px;">
                                <input type="hidden" name="usuario_id" value="{{ u[0] }}">
                                <select name="rol" class="select-rol">
                                    <option value="Usuario" {% if u[2] == 'Usuario' %}selected{% endif %}>Usuario</option>
                                    <option value="Verificado" {% if u[2] == 'Verificado' %}selected{% endif %}>Verificado</option>
                                    <option value="Admin" {% if u[2] == 'Admin' %}selected{% endif %}>Admin</option>
                                </select>
                                <button type="submit" class="btn-save">OK</button>
                            </form>

                            {% if u[1] != 'Carth' %}
                            <a href="/admin/borrar_usuario/{{ u[1] }}" 
                               style="color: #ff4d4d; text-decoration: none; font-size: 0.9em; margin-left: 10px;"
                               onclick="return confirm('¬øSeguro que quieres eliminar a @{{ u[1] }}?')">
                                üóëÔ∏è Eliminar
                            </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <hr style="border: 0; border-top: 1px solid #333; margin: 40px 0;">

        <h2>üîë Configurar Permisos por Rol</h2>
        <p style="font-size: 0.8em; color: #888; margin-bottom: 20px;">Controla qu√© puede hacer cada rango en la web.</p>
        
        {% for r in lista_roles %}
        <form action="/admin/actualizar_permisos" method="POST" style="background: #1a1a1a; padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #333;">
            <input type="hidden" name="rol" value="{{ r[0] }}">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                <strong style="color: #0095f6; min-width: 100px;">{{ r[0] }}</strong>
                
                <div style="display: flex; gap: 20px; font-size: 0.9em;">
                    <label style="cursor:pointer"><input type="checkbox" name="puede_borrar_fotos" {{ 'checked' if r[1] }}> Borrar Fotos</label>
                    <label style="cursor:pointer"><input type="checkbox" name="puede_borrar_usuarios" {{ 'checked' if r[2] }}> Borrar Users</label>
                    <label style="cursor:pointer"><input type="checkbox" name="puede_gestionar_roles" {{ 'checked' if r[3] }}> Crear Roles</label>
                </div>
                
                <button type="submit" class="btn-save" style="background: #28a745;">Guardar Permisos</button>
            </div>
        </form>
        {% endfor %}
    </div>
</body>
</html>