<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Post de @{{ post[0] }} - TemuGram</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='estilos.css') }}">
</head>
<body style="background: #000; color: white;">
    <nav class="navbar">
        <a href="{{ url_for('main_routes.index') }}" class="btn-volver">‚Üê Volver al Inicio</a>
        <a href="{{ url_for('main_routes.index') }}" style="text-decoration: none; color: white; margin-left: 20px;">
            <span style="font-size: 1.2rem;">üì∑</span> <strong>TemuGram</strong>
        </a>
    </nav>

    <div class="post-container-full">
        <div class="post-image-side" id="imageWrapper">
            <img src="{{ post[2] }}" id="mainImage" alt="Post">
        </div>

        <div class="post-info-side">
            <div style="padding: 15px; border-bottom: 1px solid #222;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <span style="font-size: 1.5rem;">{{ post[5] or 'üë§' }}</span>
                    <strong style="color: #ff4d4d;">@{{ post[0] }}</strong>
                </div>
                <p style="color: #eee; margin-bottom: 15px; font-size: 0.95rem;">{{ post[1] }}</p>
                
                <div class="post-stats-detalle">
                    <button onclick="darLike('{{ post[3] }}')" id="btn-like-{{ post[3] }}" class="btn-like-clean">
                        ‚ù§Ô∏è <span id="like-count-{{ post[3] }}">{{ post[7] or post[6] or 0 }}</span> Me gusta
                    </button>
                </div>
            </div>

            <div class="scroll-comentarios">
                {% if comentarios %}
                    {% for c in comentarios %}
                    <div class="comentario-item-clean">
                        <div style="flex: 1;">
                            <strong style="font-size: 0.9rem;">@{{ c[1] }}</strong>
                            <span style="font-size: 0.9rem; margin-left: 5px; color: #ccc;">{{ c[2] }}</span>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; align-items: center; margin-left: 10px;">
                            <form action="{{ url_for('post_routes.reaccionar_comentario', comentario_id=c[0]) }}" method="POST" style="margin: 0;">
                                <button type="submit" class="btn-like-mini" style="background:none; border:none; color:white; cursor:pointer; font-size: 0.8rem; padding: 0;">
                                    ü§ç
                                </button>
                            </form>
                            <span style="font-size: 0.7rem; color: #888;">{{ c[4] or 0 }}</span>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="color: #555; text-align: center; margin-top: 20px;">Sin comentarios a√∫n.</p>
                {% endif %}
            </div>

            <div style="padding: 15px; border-top: 1px solid #333; background: #121212;">
                <form action="{{ url_for('post_routes.comentar', post_id=post[3]) }}" method="POST" style="display: flex; gap: 8px;">
                    <input type="text" name="texto" placeholder="A√±adir un comentario..." required 
                           style="flex: 1; background: #222; border: 1px solid #444; color: white; padding: 10px; border-radius: 20px; font-size: 0.9rem;">
                    <button type="submit" class="btn-publicar-rojo">Publicar</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // 1. Zoom de Imagen (Toggle Fullscreen manual)
        const imageWrapper = document.getElementById('imageWrapper');
        const mainImage = document.getElementById('mainImage');

        mainImage.addEventListener('click', (e) => {
            e.stopPropagation(); // Evita que se cierre inmediatamente
            imageWrapper.classList.toggle('img-fullscreen');
            
            if(imageWrapper.classList.contains('img-fullscreen')) {
                imageWrapper.addEventListener('click', closeFullscreen);
            }
        });

        function closeFullscreen() {
            imageWrapper.classList.remove('img-fullscreen');
            imageWrapper.removeEventListener('click', closeFullscreen);
        }

        // 2. Like sin recargar p√°gina (AJAX)
        function darLike(postId) {
            fetch(`/reaccionar/${postId}`, { 
                method: 'POST',
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => {
                if (response.ok) {
                    const countSpan = document.getElementById(`like-count-${postId}`);
                    let currentLikes = parseInt(countSpan.innerText);
                    countSpan.innerText = currentLikes + 1;
                    
                    const btn = document.getElementById(`btn-like-${postId}`);
                    btn.style.color = '#ff4d4d';
                    btn.style.transform = 'scale(1.2)';
                    setTimeout(() => btn.style.transform = 'scale(1)', 200);
                }
            });
        }
    </script>
</body>
</html>