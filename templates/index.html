<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ðŸ“¸ TemuGram</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='estilos.css') }}">
</head>
<body>

<nav class="navbar">
    <strong>ðŸ“¸ TemuGram</strong>

    <div>
        {% if session.get('username') %}
            Hola, @{{ session['username'] }}
            <a href="{{ url_for('post_routes.crear_post') }}">Publicar</a>
            <a href="{{ url_for('auth_routes.logout') }}">Salir</a>
        {% else %}
            <a href="{{ url_for('auth_routes.login') }}">Login</a>
            <a href="{{ url_for('auth_routes.registro') }}">Registro</a>
        {% endif %}
    </div>
</nav>

<main class="feed">
    {% if posts %}
        {% for p in posts %}
        <div class="post">
            <div class="post-header">
                <span>{{ p[5] or 'ðŸ‘¤' }}</span>
                <strong>@{{ p[0] }}</strong>
            </div>

            <img src="{{ p[2] }}" class="post-img" style="max-width: 100%; border-radius: 8px;">

            <div class="post-info" style="margin-top: 10px;">
                <strong>@{{ p[0] }}</strong> 
                <span>{{ p[1] }}</span> </div>

            <div class="comentarios-seccion" style="padding: 10px; font-size: 0.9em;">
            <div class="lista-comentarios">
                {# Buscamos en el diccionario usando el ID del post actual p[3] #}
                {% if comentarios_dic.get(p[3]) %}
                    {% for c in comentarios_dic[p[3]] %}
                        <p style="margin: 5px 0;">
                            <span>{{ c.emoji or 'ðŸ’¬' }}</span>
                            <strong>@{{ c.username }}:</strong> {{ c.texto }}
                        </p>
                    {% endfor %}
                {% else %}
                    <p style="color: #666; font-size: 0.8em;">Sin comentarios aÃºn...</p>
                {% endif %}
            </div>

            <form action="{{ url_for('post_routes.comentar', post_id=p[3]) }}" method="POST" style="display: flex; gap: 5px; margin-top: 10px;">
                <input type="text" name="contenido" placeholder="AÃ±adir comentario..." required 
                    style="flex-grow: 1; background: #2c2c2c; border: none; color: white; border-radius: 4px; padding: 5px;">
                <button type="submit" style="background: none; border: none; color: #0095f6; font-weight: bold; cursor: pointer;">Publicar</button>
            </form>
        </div>

        
        </div>
        <hr style="border: 0.5px solid #333; margin: 20px 0;">
        {% endfor %}
    {% else %}
        <p style="text-align: center;">AÃºn no hay publicaciones. Â¡SÃ© el primero!</p>
    {% endif %}
</main>
</body>
</html>
