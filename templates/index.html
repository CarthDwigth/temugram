<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>üì∏ TemuGram</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='estilos.css') }}">
</head>
<body>

<nav class="navbar">
    <strong>üì∏ TemuGram</strong>
    <div class="nav-links">
        {% if session.get('username') %}
            <span style="margin-right: 15px;">Hola, <b>@{{ session['username'] }}</b></span>
            <a href="{{ url_for('post_routes.crear_post') }}" class="link-publicar">Publicar</a>
            <a href="{{ url_for('auth_routes.logout') }}" class="link-salir">Salir</a>
        {% else %}
            <a href="{{ url_for('auth_routes.login') }}" class="link-login">Login</a>
            <a href="{{ url_for('auth_routes.registro') }}" class="link-registro">Registro</a>
        {% endif %}
    </div>
</nav>

<div class="main-layout">
    
    <main class="feed-column">
    {% if posts %}
        {% for p in posts %}
        <div class="post">
            
            <div class="post-header">
                <span>{{ p[5] or 'üë§' }}</span>
                <strong>@{{ p[0] }}</strong>
            </div>

            <img src="{{ p[2] }}" class="post-img">

            <div class="post-content-area">
                
                <div class="post-acciones">
                    <form action="{{ url_for('post_routes.reaccionar', post_id=p[3]) }}" method="POST">
                        <button type="submit" class="btn-like-mini">‚ù§Ô∏è</button>
                    </form>
                    <span>{{ p[6] or 0 }}</span>
                </div>

                <div class="post-info">
                    <strong>@{{ p[0] }}</strong> <span>{{ p[1] }}</span>
                </div>

                <div class="comentarios-seccion">
                    <div class="lista-comentarios">
                        {% set lista = comentarios_dic.get(p[3]) %}
                        {% if lista %}
                            {% for c in lista %}
                                <div class="comentario-item">
                                    <p class="comentario-texto">
                                        <strong>@{{ c.username }}:</strong> {{ c.texto }}
                                    </p>
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">
                                        <button class="btn-like-mini" style="font-size: 0.8rem;">ü§ç</button>
                                        <span style="font-size: 0.65rem; color: #888;">0</span> </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p style="color: grey; font-size: 0.8rem;">Sin comentarios.</p>
                        {% endif %}
                    </div>
                    
                    <form action="{{ url_for('post_routes.comentar', post_id=p[3]) }}" method="POST" style="display: flex; gap: 8px; margin-top: 10px; align-items: center;">
                        <input type="text" name="texto" placeholder="A√±adir comentario..." required 
                            style="flex-grow: 1; background: #2c2c2c; border: 1px solid #444; color: white; border-radius: 20px; padding: 8px 15px; font-size: 0.9rem;">
                        <button type="submit" class="btn-comentar-estetico">Comentar</button>
                    </form>
                </div>

            </div> </div> {% endfor %}
    {% else %}
        <p style="text-align: center;">A√∫n no hay publicaciones.</p>
    {% endif %}

    </main>

    <aside class="sidebar-column">
        <div class="comunidad-card">
            <h3 style="margin-top: 0;">üë• Comunidad</h3>
            <div class="usuarios-lista">
                {% for u in usuarios %}
                    <div class="usuario-linea" style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                        <span class="emoji-mini" style="font-size: 1.2em;">{{ u[3] or 'üë§' }}</span>
                        <div class="info-mini">
                            <a href="{{ url_for('main_routes.perfil', username=u[1]) }}" style="color: white; text-decoration: none; font-weight: bold; font-size: 0.9em;">@{{ u[1] }}</a>
                            <br>
                            <small style="color: #888; font-size: 0.8em;">{{ u[2] }}</small>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </aside>

</div> </body>
</html>
